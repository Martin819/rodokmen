(function(c,f){function r(h,d,a,b){var e=c.fn.jscb.opts.namespace.call(h,d,a);b.unshift(a);if("function"===typeof e[d])return e[d].apply(h,b);if("function"===typeof g[d])return g[d].apply(h,b)}function l(h,d){d.done(function(){h.trigger("jscb:ajax",["done",d])}).fail(function(b,c,e){a||h.trigger("jscb:ajax",["fail",d,c,e])}).always(function(){h.trigger("jscb:ajax",["always",d])});h.trigger("jscb:ajax",["start",d])}function w(h,d){var a=h.attr("id");a===f&&(a=h.prop("tagName").toLowerCase());return a===
f?f:""===d?a+"Init":a+d.split(/\W/).map(function(h){return h.charAt(0).toUpperCase()+h.slice(1)}).join("")}function k(h,d){if(!(1>d.length)){var a=d.shift(),b=d.shift();if(b===f||""===b)b=w(h,a);if(b===f)throw"JSCB: callback neither specified nor could it be inferred";if(""===a)r(h,b,f,d);else h.on(a,function(a){var n=[].slice.call(arguments,1),n=n.concat(d);return r(h,b,a,n)})}}function b(h,d){"object"==typeof d&&"data"in d&&c.isArray(d.data)&&"callback"in d&&"string"===typeof d.callback&&r(h,d.callback,
f,d.data)}function e(h){c.extend(c.fn.jscb.opts,h);if("function"!==typeof c.fn.jscb.opts.namespace)throw"JSCB: callback namespace not defined or is not a function";for(h=0;h<c.fn.jscb.opts.binds.length;){var d=c.fn.jscb.opts.binds[h],b;switch(d[0]){case ":window":b=c(window);break;case ":document":b=c(document);break;default:b=!1}b?(k(b,d.slice(1)),c.fn.jscb.opts.binds.splice(h,1)):h++}c(window).on("beforeunload",function(){a=!0})}var g={},a=!1;g.$=function(h,d){var a=[].slice.call(arguments,2);"function"===
typeof c.fn[d]&&c.fn[d].apply(this,a)};g.multiple=function(h,d){if(c.isArray(d))for(var a=0;a<d.length;a++)b(this,d[a])};g.log=function(h){if("console"in window&&"log"in window.console){var a=[].slice.call(arguments,1);if(!(1>a.length))if("apply"in window.console.log&&"function"==typeof window.console.log.apply)window.console.log.apply(window.console,a);else{for(var b="window.console.log(args[0]",c=1;c<a.length;c++)b+=",args["+c+"]";logfn=new Function("args",b+")");logfn(a)}}};g.alert=function(h,
a){alert(a)};g.focus=function(h,a){a!==f?a.focus():this.focus()};g.location=function(h,a){h&&(h.preventDefault(),h.stopPropagation());window.location.href=a};g.reload=function(h,a){h&&(h.preventDefault(),h.stopPropagation());window.location.reload(!0)};g.html=function(h,a,b){b?this.append(a):this.html(a);c.fn.jscb.opts.noAuto||this.jscbAll()};g.ajaxClass=function(a,b){"always"!=b&&this.removeClass("jscb-ajax-done jscb-ajax-fail");"start"==b?this.removeClass("jscb-ajax-always"):this.removeClass("jscb-ajax-start");
this.addClass("jscb-ajax-"+b)};g.get=function(a,d,e){a&&a.preventDefault();this.jscb("abortAjax");var k=[].slice.call(arguments,3);(function(g){var f=k,m=c.get(d).done(function(d){c.isFunction(e)?e.apply(g,[a,d].concat(f)):"string"===typeof e?g.jscb.apply(g,[e,d].concat(f)):b(g,d)});l(g,m);g.data("jscb:xhr",m)})(this)};g.getHtml=function(a,b,e,k){c(e).jscb("get",b,g.html,k)};g.formSubmit=function(a){a&&a.preventDefault();this.jscb("abortAjax");this.ajaxSubmit({beforeSubmit:function(a,h,b){for(h=0;h<
a.length;h++)b=a[h].value,"file"===a[h].type&&File!==f&&b instanceof File&&0==b.size&&(a[h].value="")}});var d=this;a=this.data("jqxhr");l(this,a);a.done(function(a){b(d,a)});this.data("jscb:xhr",a)};g.abortAjax=function(a){(a=this.data("jscb:xhr"))&&4>a.readyState&&a.abort()};g.validationError=function(a,b){this.trigger("jscb:validationError",b);this.find("[name]").removeClass("jscb-input-invalid");this.find('[name="'+b[0]+'"]').addClass("jscb-input-invalid").focus();for(var c=1;c<b.length;c++)this.find('[name="'+
b[c]+'"]').addClass("jscb-input-invalid")};c.fn.jscbAll=function(a){"object"===typeof a&&(e.call(this,a),a=f);$all=this.find("*");$all.each(function(){c(this).jscb(a)})};c.fn.jscb=function(a){"object"===typeof a&&e.call(this,a);if("string"===typeof a){var b=[].slice.call(arguments,1);r(this,a,f,b)}else this.each(function(a,b){var h=c(this);for(a=0;a<c.fn.jscb.opts.binds.length;a++){var d=c.fn.jscb.opts.binds[a];h.is(d[0])&&k(h,d.slice(1))}d=h.data("jscb");if("string"===typeof d)d=[d];else if(!c.isArray(d))return!0;
d="string"===typeof d[0]?[d]:d;for(a=0;a<d.length;a++){var e;if("string"===typeof d[a])e=[d[a]];else if(c.isArray(d[a]))e=d[a];else continue;k(h,e)}return!0});return this};c.fn.jscb.opts={namespace:f,noAuto:!1,binds:[]}})(jQuery);(function(c,f,r){var l={size:100,stroke:10,speed:5E3,color1:"#fff",color2:"#fff",pattern1:"- ",pattern2:"- ."};c.Spinner=function(c,k){var b=this.options=f.extend({},l,k),e=1.1*b.size,g=-Math.round(e/2);this.ele=f("<div/>").css({position:"absolute",width:e+"px",height:e+"px",margin:g+"px 0 0 "+g+"px","z-index":10});this.paper=Raphael(this.ele[0],b.size+2*b.stroke,b.size+2*b.stroke);this.c1=this.paper.circle(b.stroke+b.size/2,b.stroke+b.size/2,b.size/2);this.c1.attr("stroke",b.color1);this.c1.attr("stroke-width",
b.stroke);this.c1.attr("stroke-dasharray",b.pattern1);this.c2=this.paper.circle(b.stroke+b.size/2,b.stroke+b.size/2,b.size/2);this.c2.attr("stroke",b.color2);this.c2.attr("stroke-width",b.stroke);this.c2.attr("stroke-dasharray",b.pattern2);this.animating=!1};c.Spinner.prototype.play=function(c){c&&(this.animating&&this.pause(),this.ele.appendTo(c),this.ele.css("top",c.outerHeight()/2),this.ele.css("left",c.outerWidth()/2),c=Math.floor(360*Math.random()),this.c1.attr({transform:"R"+c}),this.c2.attr({transform:"R"+
c}),this.spin1=Raphael.animation({transform:"R"+c+"r360"},this.options.speed).repeat(Infinity),this.c1.animate(this.spin1),this.spin2=Raphael.animation({transform:"R"+c+"r360"},0.71*this.options.speed).repeat(Infinity),this.c2.animate(this.spin2),this.animating=!0)};c.Spinner.prototype.pause=function(){this.c1.stop(this.spin1);this.c2.stop(this.spin2);this.ele.detach();this.animating=!1};c.Spinner.prototype.element=function(){return this.ele};c.ajaxUrl=function(f){return c.baseUrl+"/ajax"+f};f.fn.nominatim=
function(){this.select2({placeholder:"Vyhledat m\u00edsto...",multiple:!0,minimumInputLength:1,maximumSelectionSize:1,ajax:{url:c.nominatimServer,type:"GET",dataType:"json",quietMillis:500,data:function(b){return{q:b,format:"json"}},results:function(b){return{results:f.map(b,function(b,c){return{id:c,text:b.display_name,name:b.display_name,lon:b.lon,lat:b.lat}})}}},initSelection:function(b,c){c([{id:0,text:b.val()}])}});var l=this.data("input");this.after('<input type="hidden" name="'+l+'" id="'+
l+'" value="" />');var k=f("#"+l);this.on("change",function(b){b.added?(b=b.added,delete b.id,delete b.text,k.val(JSON.stringify(b))):b.removed&&k.val('{"removed": true}')});return this};f.fn.personSelect=function(){var l=this.data("input");this.after('<input type="hidden" name="'+l+'" id="'+l+'" value="" />');var k=f("#"+l);this.select2({placeholder:"Vyhledat...",multiple:!0,minimumInputLength:1,ajax:{url:function(b){return c.ajaxUrl("/person/lookup/"+b)},type:"POST",dataType:"json",quietMillis:500,
results:function(b){return{results:f.map(b,function(b,k){return{id:b.id,text:c.strings.idName(b.name,b.birth)}})}}},initSelection:function(b,e){var k=JSON.parse(b.val()).tags;b.val("");e(f.map(k,function(a){return{id:a.id,text:c.strings.idName(a.name,a.birth)}}))}});this.on("change",function(b){k.val(JSON.stringify({tags:b.val}))});return this}})(window.rdk=window.rdk||{},jQuery);(function(c,f,r){function l(a,b){a=L.latLng(a.lat,0);b=L.latLng(b.lat,0);return a.distanceTo(b)}function w(a){var b={ll:L.latLng(a.lat,a.lon),text:{}};k(b,a);return b}function k(a,b){void 0===a.text[b.type]&&(a.text[b.type]=[]);a.text[b.type].push(c.strings.idName(b.person_name.name,b.person_name.birth))}function b(a){if(!f.isArray(a)||1>a.length)return[];a.sort(function(a,b){return a.lat-b.lat});for(var b=0,d=[[a[0]]],c=1;c<a.length;c++){var e=l(a[c-1],a[c]);100>e?d[b].push(a[c]):(d.push([a[c]]),
b++)}for(c=0;c<d.length;c++)d[c].sort(function(a,b){return a.lon-b.lon});a=[];for(c=0;c<d.length;c++){a.push(w(d[c][0]));for(var b=a.length-1,g=1;g<d[c].length;g++)e=a[b].ll.distanceTo(L.latLng(d[c][g].lat,d[c][g].lon)),100>e?k(a[b],d[c][g]):(a.push(w(d[c][g])),b++)}return a}var e,g;c.mapTileServer="http://otile3.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png";c.mapAttribution='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Tiles Courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">';
c.globalAjax=function(a,b){"fail"==b?vex.dialog.alert(c.strings.ajaxErrMsg.get):a&&("start"==b?c.spinner.play(f(a.target)):"always"==b&&c.spinner.pause());return!1};c.loginAjax=function(a,b){"start"==b&&(this.css("visibility","hidden"),$lb=f("#loginbox"),c.spinner.play($lb),a.stopPropagation())};c.loginFail=function(a){this.css("visibility","inherit");this.find("#loginfail").css("visibility","inherit");this.find(".focus").focus().select()};c.sidebarJscbAjax=function(a,b){return"start"==b?(clearTimeout(e),
g=setTimeout(function(){f("#sidebar-content").detach();c.spinner.play(f("#sidebar"));clearTimeout(g)},750),!1):"always"==b?(clearTimeout(g),c.spinner.pause(),!1):!0};c.cyInit=function(a){var b=this;b.cytoscape({layout:{name:"rodokmen"},renderer:{name:"raphael",multiSelect:!1},style:cytoscape.stylesheet().selector("node.p").css({"background-color":"#006280",shape:"roundrectangle",width:50,height:40,content:"data(name)","text-valign":"center","text-outline-width":0,color:"#fff","font-size":15,"font-weight":"normal",
"font-family":"sans-serif"}).selector("node.m").css({"background-color":"#006280",content:"",shape:"circle",width:20}).selector(":selected").css({"border-width":3,"border-color":"#eee"}).selector("edge").css({"curve-style":"bezier",width:2,"target-arrow-shape":"none","source-arrow-shape":"none","line-color":"#006280"}).selector("edge.questionable").css({"line-style":"dotted","target-arrow-shape":"diamond"}).selector(".faded").css({opacity:0.25,"text-opacity":0}),showOverlay:!1,ready:function(a){window.cy=
this;this.boxSelectionEnabled(!1);b.jscb("cyLoad")}})};c.cyLoad=function(a,b){cy.nodes().unselect();cy.elements().remove();this.jscb("get",c.ajaxUrl("/lineage"),function(a,k){cy.load(k,function(){this.nodes().ungrabify();this.nodes().on("select",function(a){a=a.cyTarget[0];var b=a.hasClass("p")?"/person/":"/marriage/";f().jscb("getHtml",c.ajaxUrl(b+a.data().oid),"#sidebar")});this.nodes().on("unselect",function(a){e=setTimeout(function(){f("#sidebar-content").detach();clearTimeout(e)},100)});c.spinner.pause();
b&&f().jscb("cySelect",b)})})};c.cyJscbAjax=function(a,b){"always"==b&&a.stopPropagation()};c.cySelect=function(a,b){a&&(a.preventDefault(),a.stopPropagation());cy.nodes(":selected").unselect();cy.nodes("#"+b).select()};c.cyEdited=function(a,b){var d=this.closest(".vex").data("vex");d.afterClose=function(){f("#cy").jscb("cyLoad",b)};vex.close(d.id)};c.vexOpen=function(a,b,d){a&&(a.preventDefault(),a.stopPropagation());vex.open({content:"<h2>"+d+'</h2><div class="hr"></div>',css:{padding:"50px 0"},
contentCSS:{position:"absolute",top:"50px",bottom:"50px",left:"20%"},afterOpen:function(a){f().jscb("getHtml",b,a,!0)},afterClose:function(){},onSubmit:function(){}})};c.vexAjax=function(a,b){"start"==b&&(c.spinner.play(this.closest(".vex")),this.children().hide(),a.stopPropagation())};c.vexValidationError=function(){this.children().show();this.find("input[type=radio]").removeClass("jscb-input-invalid").closest(".vex-dialog-edit").addClass("jscb-input-invalid")};c.vexClose=function(a){a=this.closest(".vex");
this.find("form").jscb("abortAjax");c.spinner.pause();vex.close(a.data("vex").id)};c.fotorama=function(a,b){if(!a||1==a.which&&!a.ctrlKey){a.preventDefault();var d=f("#fotorama").data("fotorama");d.show(b);d.requestFullScreen()}};c.mapInit=function(a){this.jscb("get",c.ajaxUrl("/places"),function(a,d){var e=b(d);map=L.map("map").setView([42,0],2);L.tileLayer(c.mapTileServer,{attribution:c.mapAttribution,maxZoom:18}).addTo(map);L.Icon.Default.imagePath=c.baseUrl+"/rs/leaflet";for(var k=[],g=0;g<e.length;g++){var f=
e[g];k.push(f.ll);var l=L.marker(f.ll),q="",s;for(s in f.text){for(var q=q+("<h3>"+c.strings.mapPopup[s]+"</h3><ul>"),p=0;p<f.text[s].length;p++)q+="<li>"+f.text[s][p]+"</li>";q+="</ul>"}l.bindPopup(q);l.addTo(map)}0<k.length&&map.fitBounds(L.latLngBounds(k),{maxZoom:8});3<map.getZoom()&&map.zoomOut(1,{animate:!1})})};c.adminTab=function(a,b){f(".tab").hide();f(b).show()};f(document).ready(function(){f.ajaxSetup({timeout:2E4});c.spinner=new c.Spinner(r,{size:80,stroke:4,color1:"#1173A7",color2:"#1173A7",
speed:8E3});f(".jscb").jscb({namespace:function(){return window.rdk},binds:[["body","jscb:ajax","globalAjax"],[".focus","","focus"],[".nominatim","","$","nominatim"],[".fotorama","","$","fotorama"],[".personSelect","","$","personSelect"],[".vex-dialog-form","submit"],[".vex-dialog-form","jscb:ajax","vexAjax"],[".vex-dialog-form","jscb:validationError","vexValidationError"],[".vex-cancel","click","vexClose"]]})})})(window.rdk=window.rdk||{},jQuery);(function(c){function f(f){this.options=c.util.extend({},r,f)}c.fn.eles({nodesTo:function(c){return this.neighborhood("edge[source='"+this.id()+"']").targets(c)},nodesFrom:function(c){return this.neighborhood("edge[target='"+this.id()+"']").sources(c)},isM:function(){return!!this.nodes().hasClass("m")},hasM:function(){return!this.neighborhood("edge[source='"+this.id()+"']").empty()},rod:function(f){void 0===this._private.scratch.RodokmenLayout&&(this._private.scratch.RodokmenLayout={});if(void 0===
f)return this._private.scratch.RodokmenLayout;c.util.extend(this._private.scratch.RodokmenLayout,f)},pathWidth:function(){return this.isM()?this.rod().mpath_w:this.outerWidth()}});var r={ready:void 0,stop:void 0,autoFit:!0,padding:30,hdist:50,mdist:30,vdist:80,baryScans:3,rendererRaphael:!0};f.prototype.run=function(){function c(a,b){var d=a.outerHeight();if(void 0===y[b]||d>y[b])y[b]=d}function f(a,b){function d(g){for(var f;!g.rod().mark_mpath;g=f){g.rod().mark_mpath=!0;f=g;a.rod().mpath.push(g);
c(g,e);if(g.isM())g.nodesFrom().each(function(a,b){b.rod().mark_mpath||(f=b)}),g.nodesTo().each(function(d,c){a.rod().mpath_c.push(c);c.rod().gen=e+1;b.push(c)});else{var n=!1;g.nodesTo().each(function(a,d){n?(d.rod().gen=e,b.push(d)):d.rod().mark_mpath||(f=d,n=!0)});var m=g.nodesFrom()[0];m&&(a.rod().mpath_p.push(m),m.rod().gen=e-1,b.push(m))}g.rod({gen:e,x:k});h+=r+g.outerWidth()}}var h=a.outerWidth(),e=a.rod().gen,k=a.rod().x;a.rod({mark_mpath:!0,mpath:[],mpath_p:[],mpath_c:[]});var g=a.nodesFrom();
d(g[0]);a.rod().mpath.reverse();a.rod().mpath.push(a);a.rod().mpath_m=a.rod().mpath.length;d(g[1]);a.rod().mpath_w=h;a.nodesTo().each(function(d,c){a.rod().mpath_c.push(c);c.rod().gen=e+1;b.push(c)})}function k(a){if(a.isM())return a.rod().mpath_p.concat(a.rod().mpath_c);a=a.nodesFrom();return a.length?[a[0]]:[]}function b(a){function b(){var a=(n[0].rod().x+n[n.length-1].rod().x)/2-v/2;a<m&&(a=m);for(var c="",d=0;d<n.length;d++)c+=n[d].id()+" ",a+=n[d].pathWidth()/2,n[d].rod().x=a,a+=n[d].pathWidth()/
2+t;l=!1}function d(a,b,c){var e=(b<c)-(b>c),h=a.rod().x-a.rod().mpath_w/2,g=a.rod().mpath,f=0;for(a=b;a!=c+e;a+=e)h+=g[a].outerWidth()/2,g[a].rod().x=h,h+=g[a].outerWidth()/2+r,g[a].isM()||g[a].nodesFrom().each(function(a,b){var c=g[a].rod().x-b.rod().x;f+=c*c});return f}for(var c=0;c<a.length;c++){var h=a[c],g=k(h),e=0,f;for(f=0;f<g.length;f++)e+=g[f].rod().x;if(0<f&&(e/=f,h.rod().x=e,h.isM()))for(f=h.rod().mpath,h=0;h<f.length;h++)f[h].rod().x=e}a.sort(function(a,b){return a.rod().x-b.rod().x});
for(var l=!1,n,m,v,e=a[0].rod().x+a[0].pathWidth()/2+t,c=1;c<a.length;c++)f=a[c],e+=f.pathWidth()/2,l?f.rod().x>=e?b():(v+=t+f.pathWidth(),n.push(f)):f.rod().x<e&&(n=[],l=!0,m=1==c?Number.NEGATIVE_INFINITY:a[c-2].rod().x+a[c-2].pathWidth()+t,v=a[c-1].pathWidth()+t+f.pathWidth(),n.push(a[c-1]),n.push(f)),f.rod().x>e&&(e=f.rod().x),e+=f.pathWidth()/2+t;l&&b();for(c=0;c<a.length;c++)if(f=a[c],f.isM()){e=f.rod().mpath;h=f.rod().x;g=d(f,0,e.length-1);f.rod().x=h;var p=d(f,e.length-1,0);g<p&&(f.rod().x=
h,d(f,0,e.length-1))}}function e(a){a>s||(b(p[a],!0),e(a+1),b(p[a],!1))}function g(a){a.rod().y=u;a.rod().x<A&&(A=a.rod().x);a.rod().x>B&&(B=a.rod().x)}var a=this.options,h=a.cy,d=h.nodes();h.edges();var n=h.container(),v=n.clientWidth,n=n.clientHeight,t=a.hdist,r=a.mdist;if(d.length){if(a.rendererRaphael){var m=h._private.renderer;h.nodes().each(function(a,b){b.position({x:0,y:0})});m.notify({type:"load",collection:h.elements()})}var q,s,p=[],x=[],y=[];(function(){var a=[],b=d[0];!b.isM()&&b.hasM()&&
(b=b.nodesTo()[0]);b.rod().gen=0;for(a.push(b);a.length;)if(b=a.pop(),!b.rod().mark_dfs){b.rod().mark_dfs=!0;var e=b.rod().gen,h;if(void 0===q||e<q)q=e;if(void 0===s||e>s)s=e;void 0===p[e]&&(p[e]=[]);void 0===x[e]&&(x[e]=0);c(b,e);if(b.isM())h=x[e],b.rod().x=h,f(b,a),x[e]=h+b.rod().mpath_w+t,p[e].push(b);else if(b.hasM()){var g=b.nodesTo()[0];g.rod().gen=e;a.push(g)}else{h=x[e];x[e]=h+b.outerWidth()+t;p[e].push(b);if(g=b.nodesFrom()[0])g.rod().gen=e-1,a.push(g);b.rod({x:h,w:1})}}})();for(m=0;m<a.baryScans;m++)e(q);
for(m=q;m<=s;m++)b(p[m]);for(var u=0,A=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY,m=q;m<=s;m++){for(var u=u+y[m]/2,z=0;z<p[m].length;z++)if(p[m][z].isM())for(var D=p[m][z].rod().mpath,C=0;C<D.length;C++)g(D[C]);else g(p[m][z]);u+=y[m]/2+a.vdist}u-=a.vdist;d.positions(function(a,b){return{x:b.rod().x,y:b.rod().y}});m=a.padding;a.autoFit&&(u+2*m>n||Math.abs(B-A)+2*m>v)&&h.fit(m);h.center(d)}h.one("layoutready",a.ready);h.trigger("layoutready");h.one("layoutstop",a.stop);h.trigger("layoutstop")};
f.prototype.stop=function(){};c("layout","rodokmen",f)})(cytoscape);(function(c,f,r){function l(f){this.options=c.extend({},w,f);this.data={cy:f.cy,container:f.cy.container(),fitLabels:this.options.fitLabels}}var w={minZoom:0.1,maxZoom:10,multiSelect:!0,fitLabels:!0,labelPad:10};l.isTouch=f.is.touch();l.prototype.bindEvents=function(){function f(a){return(a=b.getElementByPoint(a.pageX,a.pageY))?a.data("cy"):null}var b=this.data.paper,e=this.data.cy,g=this.options;c(b.canvas).click(function(a){a.preventDefault();if(0==a.button){var b=f(a),c=b?"[id != '"+b.id()+"']":
"";g.multiSelect&&a.shiftKey||e.nodes(":selected"+c).unselect();b&&b.selectable()&&!b.selected()&&b.select()}}).mouseup(function(a){a.preventDefault();1==a.button&&(e.zoom(1),e.center(),e.nodes().unselect())}).drag("init",function(a,b){a.preventDefault();var d=f(a),g;d?(g=!d.grabbable(),d.selected()&&(d=e.nodes("node:selected:grabbable")),d.each(function(a,b){b.rscratch("raphael").dragOrigPos={x:b.position().x,y:b.position().y}})):g=!e.userPanningEnabled();d={ignore:g,ele:d,origPan:{x:e.pan().x,y:e.pan().y}};
c(this).data("rdkDrag",d)}).drag("start",function(a,b){var d=c(this).data("rdkDrag");d.ele&&!d.ignore&&d.ele.grabbed(!0)}).drag(function(a,b){a.preventDefault();var d=c(this).data("rdkDrag");if(!d.ignore)if(d.ele){var g=e.zoom();d.ele.each(function(a,c){var d=c.rscratch("raphael").dragOrigPos;c.position({x:d.x+b.deltaX/g,y:d.y+b.deltaY/g})})}else e.pan({x:d.origPan.x+b.deltaX,y:d.origPan.y+b.deltaY})}).drag("end",function(a,b){var d=c(this).data("rdkDrag");d.ele&&d.ele.grabbed(!1)}).mousewheel(function(a){a.preventDefault();
if(e.userZoomingEnabled()){var b=e.zoom()+e.zoom()*a.deltaY/4,d=g.minZoom,f=g.maxZoom,b=b>f?f:b<d?d:b,d=c(this).offset();e.zoom({level:b,renderedPosition:{x:a.pageX-d.left,y:a.pageY-d.top}})}})};l.prototype.init=function(c){var b=this.data;b.paper?b.paper.clear():(b.paper=new Raphael(b.container,b.container.clientWidth,b.container.clientHeight),this.bindEvents());b.rEles=b.paper.set();b.fitLabels=this.options.fitLabels;this.addEles(c)};l.prototype.nodeAttrs=function(c,b){var e=c.position(),g=c.width();
b+=2*this.options.labelPad;this.data.fitLabels&&0<c.style().content.length&&g<b&&(g=b,c.css("width",g));var a=c.height();switch(c.style().shape){case "ellipse":return{cx:e.x,cy:e.y,r:g/2};case "roundrectangle":return{x:e.x-g/2,y:e.y-a/2,width:g,height:a,r:f.math.getRoundRectangleRadius(g,a)}}};l.prototype.labelPos=function(c){return c.position()};l.prototype.makeNode=function(c){var b=this.data.paper,e=this.nodeAttrs(c),g=this.labelPos(c);c.width();c.height();c.rscratch("raphael",{});var a=c.rscratch("raphael"),
f=c.style().content,g=b.text(g.x,g.y,f);g.data("cy",c);var d;switch(c.style().shape){case "ellipse":d=b.circle(e.cx,e.cy,e.r);break;case "roundrectangle":d=b.rect(e.x,e.y,e.width,e.height,e.r)}d.data("cy",c);d.insertBefore(g);a.nodeId=d.id;a.labelId=g.id;c=b.set();c.push(d);c.push(g);return c};l.prototype.makeEdgePath=function(c,b,e,g){b=c.source().position();e=c.target().position();return"bezier"==c.style().curveStyle?[["M",b.x,b.y],["C",b.x,b.y+2*(e.y-b.y)/3,e.x,b.y+(e.y-b.y)/3,e.x,e.y]]:[["M",
b.x,b.y],["L",e.x,e.y]]};l.prototype.makeEdge=function(c){var b=this.data.paper;c.rscratch("raphael",{});var e=c.rscratch("raphael"),g=this.makeEdgePath(c),b=b.path(g);b.id=c.id();b.data("cy",c);e.edgeId=b.id;e.edgePath=g;return b};l.prototype.addEles=function(c){var b=this;c.nodes().each(function(c,g){b.makeNode(g)});c.edges().each(function(c,g){b.makeEdge(g)});this.updateStyle(c)};l.prototype.removeEles=function(c){var b=this.data.paper;c.nodes().each(function(c,g){var a=g.rscratch("raphael");b.getById(a.nodeId).remove();
b.getById(a.labelId).remove()});c.edges().each(function(c,g){b.getById(g.rscratch("raphael").edgeId).remove()})};l.prototype.updateViewport=function(){var c=this.data.paper,b=this.data.cy.zoom(),e=this.data.cy.pan();c.forEach(function(c){c.transform("s"+b+","+b+",0,0T"+e.x+","+e.y);var a=c.data("cy"),a=(a.isNode()?a._private.style["border-width"]:a._private.style.width).value;c.attr({"stroke-width":a*b})})};l.prototype.updatePositions=function(c){var b=this,e=this.data.paper;c.nodes().each(function(c,
a){function f(a,c){var d=a.rscratch("raphael");d.edgePath=b.makeEdgePath(a);e.getById(d.edgeId).attr({path:d.edgePath})}var d=a.rscratch("raphael"),k=e.getById(d.nodeId),d=e.getById(d.labelId);k.attr(b.nodeAttrs(a));d.attr(b.labelPos(a));k=a.neighborhood("edge[source='"+a.id()+"']");d=a.neighborhood("edge[target='"+a.id()+"']");k.each(function(a,b){f(b,!0)});d.each(function(a,b){f(b,!1)})})};l.prototype.updateStyle=function(c){var b=this,e=this.data.paper,g=b.data.cy.zoom();c.nodes().each(function(a,
c){var d=e.getById(c.rscratch("raphael").nodeId),f=e.getById(c.rscratch("raphael").labelId),k=c._private.style;f.attr({fill:k.color.strValue,"font-family":k["font-family"].strValue,"font-size":k["font-size"].strValue,"font-weight":k["font-weight"].strValue,stroke:0<k["text-outline-width"]?k["text-outline-color"].strValue:"none","stroke-width":k["text-outline-width"].value,"stroke-opacity":k["text-outline-opacity"].value,cursor:"default"});d.attr(b.nodeAttrs(c,f.getBBox().width));d.attr({fill:k["background-color"].strValue,
stroke:0<k["border-width"].value?k["border-color"].strValue:"none","stroke-width":k["border-width"].value*g,"stroke-opacity":k["border-opacity"].value})});c.edges().each(function(a,b){var c=e.getById(b.rscratch("raphael").edgeId),f=b._private.style;c.attr({stroke:f["line-color"].strValue,"stroke-width":f.width.value*g,opacity:f.opacity.value});c.toBack()})};l.prototype.notify=function(c){switch(c.type){case "load":this.init(c.collection);this.updateViewport();break;case "add":this.addEles(c.collection);
case "remove":this.removeEles(c.collection);break;case "position":this.updatePositions(c.collection);break;case "viewport":this.updateViewport();break;case "style":this.updateStyle(c.collection);break;case "destroy":this.destroy()}};l.prototype.destroy=function(){this.data.paper.clear()};f("renderer","raphael",l)})(jQuery,cytoscape);
